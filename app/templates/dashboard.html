<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Network Command - LCARS Interface</title>
<link rel="icon" type="image/jpeg" href="/static/images/favicon16x16.jpg">
<link href="https://fonts.googleapis.com/css2?family=Antonio:wght@400;700&family=Orbitron:wght@400;500;700;900&family=Share+Tech+Mono&display=swap" rel="stylesheet">
<style>
@keyframes scan{0%{top:-2px}100%{top:100%}}
@keyframes pulse{0%,100%{opacity:.7}50%{opacity:1}}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.3}}
@keyframes fadeUp{from{opacity:0;transform:translateY(15px)}to{opacity:1;transform:translateY(0)}}
@keyframes borderFlow{0%{background-position:0% 50%}100%{background-position:200% 50%}}
@keyframes devicePulse{0%,100%{box-shadow:0 0 4px currentColor}50%{box-shadow:0 0 12px currentColor,0 0 24px currentColor}}
@keyframes dataStream{0%{opacity:.3}50%{opacity:.8}100%{opacity:.3}}

*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}

:root{
--gold:#f1a136;--orange:#f0884a;--red:#d9534f;--blue:#8e96e3;
--ltblue:#99ccff;--purple:#9c88ff;--teal:#66cccc;--bg:#000;
--panel:#0a0a14;--text:#f0e6d0;--dim:#667788;--border:rgba(241,161,54,.2);
--fdisplay:'Orbitron',sans-serif;--fdata:'Share Tech Mono',monospace;--flabel:'Antonio',sans-serif;
}

html,body{background:var(--bg);color:var(--text);font-family:var(--fdata);min-height:100vh;overflow-x:hidden}
body::after{content:'';position:fixed;top:-2px;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,rgba(241,161,54,.2),rgba(153,204,255,.3),transparent);animation:scan 8s linear infinite;pointer-events:none;z-index:99999}

.lcars-frame{display:grid;grid-template-columns:140px 1fr;grid-template-rows:auto 1fr auto;min-height:100vh;gap:0}

/* SIDEBAR */
.lcars-sidebar{grid-row:1/-1;background:var(--panel);display:flex;flex-direction:column;gap:3px}
.lcars-elbow-top{background:var(--gold);height:80px;border-radius:0 0 0 40px;position:relative}
.lcars-elbow-top::after{content:'';position:absolute;bottom:0;right:0;width:100%;height:40px;background:var(--bg);border-radius:0 20px 0 0}
.lcars-bar{flex:1;display:flex;flex-direction:column;gap:3px}
.lcars-block{width:100%;border-radius:0 20px 20px 0;padding:8px 12px;font-family:var(--flabel);font-size:.7rem;letter-spacing:.08em;text-transform:uppercase;color:rgba(0,0,0,.8);font-weight:700;cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:flex-end;text-align:right;min-height:40px;position:relative}
.lcars-block:hover{filter:brightness(1.3);transform:scaleX(1.02)}
.lcars-block.active{filter:brightness(1.4);transform:scaleX(1.05)}
.lcars-block.active::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px;background:#fff;border-radius:0 2px 2px 0}
.lcars-block.gold{background:var(--gold)}
.lcars-block.orange{background:var(--orange)}
.lcars-block.blue{background:var(--blue)}
.lcars-block.purple{background:var(--purple)}
.lcars-block.teal{background:var(--teal)}
.lcars-block.red{background:var(--red)}
.lcars-block.ltblue{background:var(--ltblue)}
.lcars-elbow-bottom{background:var(--orange);height:55px;border-radius:40px 0 0 0;position:relative;margin-top:3px}
.lcars-elbow-bottom::before{content:'';position:absolute;top:0;right:0;width:100%;height:28px;background:var(--bg);border-radius:0 0 20px 0}

/* TOPBAR */
.lcars-topbar{display:flex;align-items:stretch;gap:3px;height:80px}
.topbar-left{background:var(--gold);border-radius:0 0 30px 0;min-width:220px;display:flex;align-items:center;justify-content:center;padding:0 24px}
.topbar-title{font-family:var(--fdisplay);font-size:.8rem;font-weight:900;letter-spacing:.15em;color:#000;text-transform:uppercase}
.topbar-center{flex:1;background:var(--panel);display:flex;align-items:center;justify-content:center;gap:2.5rem;padding:0 1.5rem;position:relative;overflow:hidden}
.topbar-center::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,var(--gold),var(--blue),var(--purple),var(--gold));background-size:200% 100%;animation:borderFlow 4s linear infinite}
.topbar-right{background:var(--orange);border-radius:0 0 0 30px;min-width:200px;display:flex;align-items:center;justify-content:center;padding:0 24px}
.stardate{font-family:var(--fdisplay);font-size:.7rem;font-weight:700;color:#000;letter-spacing:.1em}

.status-readout{display:flex;align-items:center;gap:6px;font-size:.7rem}
.readout-label{color:var(--dim);font-size:.5rem;text-transform:uppercase;letter-spacing:.12em}
.readout-value{color:var(--ltblue);font-weight:700;font-size:.8rem}
.readout-value.alert{color:var(--red);animation:blink 2s ease-in-out infinite}
.readout-value.ok{color:var(--teal)}
.readout-dot{width:6px;height:6px;border-radius:50%;background:var(--teal);animation:pulse 2s ease-in-out infinite}
.readout-dot.offline{background:var(--red);animation:blink 1.5s ease-in-out infinite}

/* MAIN */
.lcars-main{padding:1.25rem 1.5rem;display:flex;flex-direction:column;gap:1.25rem;overflow-y:auto}

/* VIEW PANELS ‚Äî only one visible at a time */
.view-panel{display:none}
.view-panel.active{display:block}

.section-header{display:flex;align-items:center;gap:0;margin-bottom:.5rem}
.section-pill{background:var(--gold);color:#000;font-family:var(--fdisplay);font-size:.55rem;font-weight:700;letter-spacing:.15em;text-transform:uppercase;padding:6px 20px;border-radius:15px 0 0 15px;white-space:nowrap}
.section-line{flex:1;height:3px;background:linear-gradient(90deg,var(--gold),transparent)}

/* DATA PANELS */
.panels-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
.data-panel{background:var(--panel);border:1px solid var(--border);border-radius:0 12px 12px 0;padding:1rem;position:relative;overflow:hidden;animation:fadeUp .6s ease-out backwards}
.data-panel::before{content:'';position:absolute;top:0;left:0;bottom:0;width:4px;background:var(--gold)}
.data-panel:nth-child(2)::before{background:var(--blue)}
.data-panel:nth-child(3)::before{background:var(--teal)}
.data-panel:nth-child(4)::before{background:var(--orange)}
.panel-title{font-family:var(--fdisplay);font-size:.5rem;font-weight:700;letter-spacing:.15em;text-transform:uppercase;color:var(--gold);margin-bottom:.75rem}
.data-panel:nth-child(2) .panel-title{color:var(--blue)}
.data-panel:nth-child(3) .panel-title{color:var(--teal)}
.data-panel:nth-child(4) .panel-title{color:var(--orange)}
.data-row{display:flex;justify-content:space-between;padding:4px 0;border-bottom:1px solid rgba(255,255,255,.03);font-size:.75rem}
.data-row:last-child{border:none}
.data-label{color:var(--dim)}
.data-val{color:var(--text);font-weight:700}
.data-val.highlight{color:var(--ltblue)}
.data-val.warn{color:var(--red)}

/* TOOL CARDS */
.tools-row{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
.tool-panel{background:var(--panel);border:1px solid var(--border);border-radius:20px 20px 12px 12px;overflow:hidden;transition:all .3s;cursor:pointer;position:relative;animation:fadeUp .7s ease-out backwards}
.tool-panel:nth-child(1){animation-delay:.1s}
.tool-panel:nth-child(2){animation-delay:.2s}
.tool-panel:nth-child(3){animation-delay:.3s}
.tool-panel:hover{border-color:var(--gold);transform:translateY(-4px);box-shadow:0 8px 30px rgba(241,161,54,.15)}
.tool-header{padding:10px 16px;display:flex;align-items:center;justify-content:space-between}
.tool-panel:nth-child(1) .tool-header{background:var(--blue)}
.tool-panel:nth-child(2) .tool-header{background:var(--gold)}
.tool-panel:nth-child(3) .tool-header{background:var(--purple)}
.tool-name{font-family:var(--fdisplay);font-size:.6rem;font-weight:900;letter-spacing:.12em;text-transform:uppercase;color:#000}
.tool-ver{font-family:var(--fdata);font-size:.55rem;color:rgba(0,0,0,.5)}
.tool-body{padding:1.25rem;display:flex;flex-direction:column;gap:.75rem}
.tool-desc{color:var(--dim);font-size:.78rem;line-height:1.5}
.tool-badges{display:flex;flex-wrap:wrap;gap:4px}
.tool-badge{padding:3px 8px;border-radius:3px;font-size:.55rem;letter-spacing:.08em;text-transform:uppercase;font-weight:700;border:1px solid}
.tool-panel:nth-child(1) .tool-badge{color:var(--blue);border-color:rgba(142,150,227,.3);background:rgba(142,150,227,.08)}
.tool-panel:nth-child(2) .tool-badge{color:var(--gold);border-color:rgba(241,161,54,.3);background:rgba(241,161,54,.08)}
.tool-panel:nth-child(3) .tool-badge{color:var(--purple);border-color:rgba(156,136,255,.3);background:rgba(156,136,255,.08)}
.tool-launch{display:block;text-align:center;padding:8px;border-radius:8px;font-family:var(--fdisplay);font-size:.55rem;font-weight:700;letter-spacing:.12em;text-transform:uppercase;text-decoration:none;transition:all .2s;margin-top:auto}
.tool-panel:nth-child(1) .tool-launch{background:rgba(142,150,227,.12);color:var(--blue);border:1px solid rgba(142,150,227,.3)}
.tool-panel:nth-child(2) .tool-launch{background:rgba(241,161,54,.12);color:var(--gold);border:1px solid rgba(241,161,54,.3)}
.tool-panel:nth-child(3) .tool-launch{background:rgba(156,136,255,.12);color:var(--purple);border:1px solid rgba(156,136,255,.3)}
.tool-launch:hover{filter:brightness(1.4);transform:scale(1.02)}

/* FLOOR PLAN */
.floor-plan-container{background:var(--panel);border:1px solid var(--border);border-radius:12px;padding:1.5rem;position:relative;min-height:400px;overflow:hidden}
.floor-plan-container::before{content:'';position:absolute;top:0;left:0;bottom:0;width:4px;background:linear-gradient(180deg,var(--teal),var(--blue));border-radius:4px 0 0 4px}
.floor-plan-svg{width:100%;height:400px}
.fp-room{fill:rgba(0,225,255,.03);stroke:var(--teal);stroke-width:1;transition:all .3s;cursor:pointer}
.fp-room:hover{fill:rgba(0,225,255,.08);stroke-width:2}
.fp-room-label{fill:var(--dim);font-family:var(--fdisplay);font-size:8px;letter-spacing:.1em;text-transform:uppercase;pointer-events:none}
.fp-device{cursor:pointer;transition:all .3s}
.fp-device:hover{transform:scale(1.3)}
.fp-device-icon{font-size:16px}
.fp-device-ring{fill:none;stroke-width:2;animation:devicePulse 3s ease-in-out infinite}
.fp-device-ring.online{stroke:var(--teal)}
.fp-device-ring.offline{stroke:var(--red);animation:blink 2s ease-in-out infinite}
.fp-device-label{fill:var(--text);font-family:var(--fdata);font-size:7px;text-anchor:middle}
.fp-device-status{font-family:var(--fdata);font-size:5px;text-anchor:middle;letter-spacing:.1em}
.fp-device-status.online{fill:var(--teal)}
.fp-device-status.offline{fill:var(--red)}
.fp-connection{stroke:rgba(0,225,255,.1);stroke-width:1;stroke-dasharray:4 4;fill:none}
.fp-legend{display:flex;gap:1.5rem;margin-top:1rem;padding-top:.75rem;border-top:1px solid var(--border)}
.fp-legend-item{display:flex;align-items:center;gap:6px;font-size:.65rem;color:var(--dim)}
.fp-legend-dot{width:8px;height:8px;border-radius:50%}

/* DEVICE DETAIL POPUP */
.device-popup{display:none;position:absolute;background:rgba(10,10,20,.97);border:1px solid var(--gold);border-radius:8px;padding:1rem;min-width:200px;z-index:100;box-shadow:0 10px 40px rgba(0,0,0,.7)}
.device-popup.show{display:block}
.device-popup h4{font-family:var(--fdisplay);font-size:.6rem;letter-spacing:.12em;color:var(--gold);margin-bottom:.5rem;text-transform:uppercase}
.device-popup .dp-row{display:flex;justify-content:space-between;font-size:.7rem;padding:3px 0}
.device-popup .dp-label{color:var(--dim)}
.device-popup .dp-val{color:var(--ltblue);font-weight:700}

/* BOTTOMBAR */
.lcars-bottombar{display:flex;align-items:stretch;gap:3px;height:50px}
.bottombar-left{background:var(--orange);border-radius:0 20px 0 0;min-width:220px;display:flex;align-items:center;justify-content:center}
.bottombar-center{flex:1;background:var(--panel);display:flex;align-items:center;justify-content:center;gap:2rem;font-size:.55rem;color:var(--dim);letter-spacing:.1em}
.bottombar-right{background:var(--gold);border-radius:20px 0 0 0;min-width:200px;display:flex;align-items:center;justify-content:center;font-family:var(--fdisplay);font-size:.5rem;font-weight:700;color:#000;letter-spacing:.1em}

/* CONFIG MODAL */
.config-overlay{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.7);backdrop-filter:blur(4px);z-index:10000;align-items:center;justify-content:center}
.config-overlay.show{display:flex}
.config-modal{background:rgba(10,10,20,.97);border:1px solid var(--gold);border-radius:12px;max-width:500px;width:90%;max-height:80vh;overflow-y:auto;padding:0}
.config-modal-header{background:var(--gold);padding:10px 20px;border-radius:12px 12px 0 0;display:flex;align-items:center;justify-content:space-between}
.config-modal-header h3{font-family:var(--fdisplay);font-size:.6rem;font-weight:700;letter-spacing:.12em;color:#000;text-transform:uppercase}
.config-modal-close{background:none;border:none;color:#000;font-size:1.2rem;cursor:pointer;padding:4px 8px}
.config-modal-body{padding:1.5rem}
.config-modal-body label{display:block;font-size:.65rem;color:var(--gold);letter-spacing:.1em;text-transform:uppercase;margin-bottom:4px;font-family:var(--fdisplay)}
.config-modal-body input,.config-modal-body select{width:100%;padding:8px 12px;background:rgba(241,161,54,.04);border:1px solid rgba(241,161,54,.2);border-radius:6px;color:var(--text);font-family:var(--fdata);font-size:.8rem;margin-bottom:1rem;outline:none;transition:border .2s}
.config-modal-body input:focus{border-color:var(--gold)}
.config-save-btn{width:100%;padding:10px;background:var(--gold);border:none;border-radius:8px;color:#000;font-family:var(--fdisplay);font-size:.6rem;font-weight:700;letter-spacing:.12em;text-transform:uppercase;cursor:pointer;transition:all .2s}
.config-save-btn:hover{filter:brightness(1.2)}

@media(max-width:900px){.lcars-frame{grid-template-columns:1fr}.lcars-sidebar{display:none}.panels-grid{grid-template-columns:1fr 1fr}.tools-row{grid-template-columns:1fr}}
@media(max-width:600px){.panels-grid{grid-template-columns:1fr}.topbar-left,.topbar-right{display:none}}
</style>
</head>
<body>
<div class="lcars-frame">
    <!-- LEFT SIDEBAR ‚Äî Labelled Navigation Tabs -->
    <div class="lcars-sidebar">
        <div class="lcars-elbow-top"></div>
        <div class="lcars-bar">
            <div class="lcars-block gold active" onclick="switchView('overview',this)">Overview</div>
            <div class="lcars-block blue" onclick="switchView('floorplan',this)">Deck Plan</div>
            <div class="lcars-block orange" onclick="switchView('devices',this)">Devices</div>
            <div class="lcars-block purple" onclick="switchView('stations',this)">Stations</div>
            <div class="lcars-block teal" onclick="switchView('diagnostics',this)">Diagnostics</div>
            <div class="lcars-block red" onclick="window.open('/threats/','_self')">Threat Watch</div>
            <div class="lcars-block ltblue" onclick="switchView('floorplan',this)">Topology</div>
            <div class="lcars-block gold" onclick="document.getElementById('config-overlay').classList.add('show')">Settings</div>
        </div>
        <div class="lcars-elbow-bottom"></div>
    </div>

    <!-- TOP BAR -->
    <div class="lcars-topbar">
        <div class="topbar-left"><div class="topbar-title">Network Command</div></div>
        <div class="topbar-center">
            <div class="status-readout"><div class="readout-dot" id="conn-dot"></div><div><div class="readout-label">Gateway</div><div class="readout-value" id="gw-model">--</div></div></div>
            <div class="status-readout"><div><div class="readout-label">Clients</div><div class="readout-value" id="client-count">--</div></div></div>
            <div class="status-readout"><div><div class="readout-label">Access Points</div><div class="readout-value" id="ap-count">--</div></div></div>
            <div class="status-readout"><div><div class="readout-label">WAN</div><div class="readout-value" id="wan-status">--</div></div></div>
            <div class="status-readout"><div><div class="readout-label">Uptime</div><div class="readout-value" id="uptime-val">--</div></div></div>
        </div>
        <div class="topbar-right"><div class="stardate" id="stardate">STARDATE --</div></div>
    </div>

    <!-- MAIN CONTENT -->
    <div class="lcars-main">

        <!-- VIEW: OVERVIEW -->
        <div class="view-panel active" id="view-overview">
            <div class="section-header"><div class="section-pill">Systems Status</div><div class="section-line"></div></div>
            <div class="panels-grid" id="status-panels">
                <div class="data-panel" style="animation-delay:.1s"><div class="panel-title">Network Devices</div>
                    <div class="data-row"><span class="data-label">Access Points</span><span class="data-val highlight" id="d-aps">--</span></div>
                    <div class="data-row"><span class="data-label">Switches</span><span class="data-val highlight" id="d-switches">--</span></div>
                    <div class="data-row"><span class="data-label">Connected Clients</span><span class="data-val highlight" id="d-clients">--</span></div>
                </div>
                <div class="data-panel" style="animation-delay:.2s"><div class="panel-title">Gateway Info</div>
                    <div class="data-row"><span class="data-label">Model</span><span class="data-val" id="d-model">--</span></div>
                    <div class="data-row"><span class="data-label">Firmware</span><span class="data-val" id="d-fw">--</span></div>
                    <div class="data-row"><span class="data-label">WAN IP</span><span class="data-val" id="d-wanip">--</span></div>
                </div>
                <div class="data-panel" style="animation-delay:.3s"><div class="panel-title">Internet Stats</div>
                    <div class="data-row"><span class="data-label">Latency</span><span class="data-val" id="d-latency">--</span></div>
                    <div class="data-row"><span class="data-label">Download</span><span class="data-val" id="d-down">--</span></div>
                    <div class="data-row"><span class="data-label">Upload</span><span class="data-val" id="d-up">--</span></div>
                </div>
                <div class="data-panel" style="animation-delay:.4s"><div class="panel-title">Device Health</div>
                    <div id="health-rows"></div>
                </div>
            </div>

            <div style="margin-top:1rem">
                <div class="section-header"><div class="section-pill" style="background:var(--blue)">Station Access</div><div class="section-line" style="background:linear-gradient(90deg,var(--blue),transparent)"></div></div>
                <div class="tools-row">
                    <div class="tool-panel" onclick="location.href='/stalker/'"><div class="tool-header"><span class="tool-name">Wi-Fi Stalker</span><span class="tool-ver">v0.11.4</span></div><div class="tool-body"><div class="tool-desc">Track Wi-Fi client devices. Monitor connections, detect roaming, maintain history logs.</div><div class="tool-badges"><span class="tool-badge">Tracking</span><span class="tool-badge">Roaming</span><span class="tool-badge">History</span></div><a href="/stalker/" class="tool-launch">Access Station</a></div></div>
                    <div class="tool-panel" onclick="location.href='/threats/'"><div class="tool-header"><span class="tool-name">Threat Watch</span><span class="tool-ver">v0.5.1</span></div><div class="tool-body"><div class="tool-desc">Monitor IDS/IPS events in real-time. View blocked threats, analyze security trends.</div><div class="tool-badges"><span class="tool-badge">IDS/IPS</span><span class="tool-badge">Attackers</span><span class="tool-badge">GeoIP</span></div><a href="/threats/" class="tool-launch">Access Station</a></div></div>
                    <div class="tool-panel" onclick="location.href='/pulse/'"><div class="tool-header"><span class="tool-name">Network Pulse</span><span class="tool-ver">v0.3.0</span></div><div class="tool-body"><div class="tool-desc">Real-time network monitoring dashboard. Bandwidth, AP status, top clients at a glance.</div><div class="tool-badges"><span class="tool-badge">Live Stats</span><span class="tool-badge">Clients</span><span class="tool-badge">Fullscreen</span></div><a href="/pulse/" class="tool-launch">Access Station</a></div></div>
                </div>
            </div>
        </div>

        <!-- VIEW: DECK PLAN (Floor Plan) -->
        <div class="view-panel" id="view-floorplan">
            <div class="section-header"><div class="section-pill" style="background:var(--teal)">Deck Plan ‚Äî Network Topology</div><div class="section-line" style="background:linear-gradient(90deg,var(--teal),transparent)"></div></div>
            <div class="floor-plan-container">
                <svg class="floor-plan-svg" id="floor-plan" viewBox="0 0 900 400">
                    <!-- Building outline -->
                    <rect x="20" y="20" width="860" height="360" rx="8" fill="none" stroke="rgba(102,204,204,.15)" stroke-width="1"/>

                    <!-- Rooms -->
                    <rect class="fp-room" x="30" y="30" width="250" height="170" rx="4" data-room="main"/>
                    <text class="fp-room-label" x="155" y="52">Main Area</text>

                    <rect class="fp-room" x="290" y="30" width="200" height="170" rx="4" data-room="office"/>
                    <text class="fp-room-label" x="390" y="52">Office</text>

                    <rect class="fp-room" x="500" y="30" width="180" height="170" rx="4" data-room="server"/>
                    <text class="fp-room-label" x="590" y="52">Server Room</text>

                    <rect class="fp-room" x="690" y="30" width="180" height="170" rx="4" data-room="ext"/>
                    <text class="fp-room-label" x="780" y="52">External</text>

                    <rect class="fp-room" x="30" y="210" width="350" height="160" rx="4" data-room="living"/>
                    <text class="fp-room-label" x="205" y="232">Living Space</text>

                    <rect class="fp-room" x="390" y="210" width="230" height="160" rx="4" data-room="bed"/>
                    <text class="fp-room-label" x="505" y="232">Bedroom Area</text>

                    <rect class="fp-room" x="630" y="210" width="240" height="160" rx="4" data-room="garage"/>
                    <text class="fp-room-label" x="750" y="232">Garage / Utility</text>

                    <!-- Devices will be placed dynamically by JS -->
                    <g id="fp-devices"></g>

                    <!-- Connection lines will be drawn by JS -->
                    <g id="fp-connections"></g>
                </svg>

                <div class="fp-legend">
                    <div class="fp-legend-item"><div class="fp-legend-dot" style="background:var(--teal)"></div> Access Point (Online)</div>
                    <div class="fp-legend-item"><div class="fp-legend-dot" style="background:var(--blue)"></div> Switch (Online)</div>
                    <div class="fp-legend-item"><div class="fp-legend-dot" style="background:var(--red)"></div> Offline</div>
                    <div class="fp-legend-item"><div class="fp-legend-dot" style="background:var(--gold);opacity:.3"></div> Clients Connected</div>
                </div>

                <div class="device-popup" id="device-popup">
                    <h4 id="dp-name">--</h4>
                    <div class="dp-row"><span class="dp-label">Model</span><span class="dp-val" id="dp-model">--</span></div>
                    <div class="dp-row"><span class="dp-label">MAC</span><span class="dp-val" id="dp-mac">--</span></div>
                    <div class="dp-row"><span class="dp-label">Status</span><span class="dp-val" id="dp-status">--</span></div>
                    <div class="dp-row"><span class="dp-label">Uptime</span><span class="dp-val" id="dp-uptime">--</span></div>
                </div>
            </div>
        </div>

        <!-- VIEW: DEVICES LIST -->
        <div class="view-panel" id="view-devices">
            <div class="section-header"><div class="section-pill" style="background:var(--orange)">Device Registry</div><div class="section-line" style="background:linear-gradient(90deg,var(--orange),transparent)"></div></div>
            <div id="device-list-container"></div>
        </div>

        <!-- VIEW: STATIONS -->
        <div class="view-panel" id="view-stations">
            <div class="section-header"><div class="section-pill" style="background:var(--blue)">Station Access</div><div class="section-line" style="background:linear-gradient(90deg,var(--blue),transparent)"></div></div>
            <div class="tools-row">
                <div class="tool-panel" onclick="location.href='/stalker/'"><div class="tool-header"><span class="tool-name">Wi-Fi Stalker</span><span class="tool-ver">v0.11.4</span></div><div class="tool-body"><div class="tool-desc">Track Wi-Fi client devices through your UniFi infrastructure. Monitor connections, detect roaming between access points, maintain historical logs.</div><div class="tool-badges"><span class="tool-badge">Device Tracking</span><span class="tool-badge">Roaming Detection</span><span class="tool-badge">History Logs</span></div><a href="/stalker/" class="tool-launch">Access Station</a></div></div>
                <div class="tool-panel" onclick="location.href='/threats/'"><div class="tool-header"><span class="tool-name">Threat Watch</span><span class="tool-ver">v0.5.1</span></div><div class="tool-body"><div class="tool-desc">Monitor IDS/IPS events in real-time. View blocked threats, top attackers, analyze security trends with GeoIP threat mapping and AbuseIPDB intelligence.</div><div class="tool-badges"><span class="tool-badge">IDS/IPS Events</span><span class="tool-badge">Top Attackers</span><span class="tool-badge">GeoIP Lookup</span><span class="tool-badge">Threat Intel</span></div><a href="/threats/" class="tool-launch">Access Station</a></div></div>
                <div class="tool-panel" onclick="location.href='/pulse/'"><div class="tool-header"><span class="tool-name">Network Pulse</span><span class="tool-ver">v0.3.0</span></div><div class="tool-body"><div class="tool-desc">Real-time network monitoring dashboard designed for always-on displays. View bandwidth, AP status, top clients, and network health at a glance.</div><div class="tool-badges"><span class="tool-badge">Live Stats</span><span class="tool-badge">Client Usage</span><span class="tool-badge">Fullscreen Mode</span></div><a href="/pulse/" class="tool-launch">Access Station</a></div></div>
            </div>
        </div>

        <!-- VIEW: DIAGNOSTICS -->
        <div class="view-panel" id="view-diagnostics">
            <div class="section-header"><div class="section-pill" style="background:var(--teal)">System Diagnostics</div><div class="section-line" style="background:linear-gradient(90deg,var(--teal),transparent)"></div></div>
            <div class="panels-grid" style="grid-template-columns:1fr 1fr">
                <div class="data-panel"><div class="panel-title">Application Info</div>
                    <div class="data-row"><span class="data-label">Version</span><span class="data-val">v1.8.9</span></div>
                    <div class="data-row"><span class="data-label">Interface</span><span class="data-val highlight">LCARS v2.0</span></div>
                    <div class="data-row"><span class="data-label">Fork</span><span class="data-val">M33HAN</span></div>
                    <div class="data-row"><span class="data-label">Base</span><span class="data-val">Crosstalk Solutions</span></div>
                    <div class="data-row"><span class="data-label">Deployment</span><span class="data-val highlight">Local</span></div>
                </div>
                <div class="data-panel"><div class="panel-title" style="color:var(--teal)">Network Summary</div>
                    <div class="data-row"><span class="data-label">Total Devices</span><span class="data-val highlight" id="diag-total">--</span></div>
                    <div class="data-row"><span class="data-label">Online</span><span class="data-val" style="color:var(--teal)" id="diag-online">--</span></div>
                    <div class="data-row"><span class="data-label">Offline</span><span class="data-val warn" id="diag-offline">--</span></div>
                    <div class="data-row"><span class="data-label">Controller</span><span class="data-val" id="diag-ctrl">--</span></div>
                </div>
            </div>
        </div>

    </div>

    <!-- BOTTOM BAR -->
    <div class="lcars-bottombar">
        <div class="bottombar-left"><span style="font-family:var(--fdisplay);font-size:.5rem;font-weight:700;color:#000;letter-spacing:.1em">UI TOOLKIT v1.8.9</span></div>
        <div class="bottombar-center"><span>FORKED BY M33HAN</span><span>‚Ä¢</span><span>BASED ON CROSSTALK SOLUTIONS</span><span>‚Ä¢</span><span>NOT AFFILIATED WITH UBIQUITI INC</span></div>
        <div class="bottombar-right">LCARS INTERFACE v2.0</div>
    </div>
</div>

<!-- CONFIG MODAL -->
<div class="config-overlay" id="config-overlay" onclick="if(event.target===this)this.classList.remove('show')">
    <div class="config-modal">
        <div class="config-modal-header"><h3>UniFi Controller Configuration</h3><button class="config-modal-close" onclick="document.getElementById('config-overlay').classList.remove('show')">&times;</button></div>
        <div class="config-modal-body">
            <label>Controller URL</label>
            <input type="text" id="cfg-url" placeholder="https://192.168.0.239">
            <label>API Key</label>
            <input type="text" id="cfg-apikey" placeholder="Enter API key from Settings > Integrations">
            <label>Username</label>
            <input type="text" id="cfg-user" placeholder="Leave blank if using API key">
            <label>Password</label>
            <input type="password" id="cfg-pass" placeholder="Leave blank if using API key">
            <button class="config-save-btn" onclick="saveConfig()">Save Configuration</button>
        </div>
    </div>
</div>
<script>
// ===== VIEW SWITCHING =====
function switchView(viewId, btn) {
    document.querySelectorAll('.view-panel').forEach(v => v.classList.remove('active'));
    document.querySelectorAll('.lcars-block').forEach(b => b.classList.remove('active'));
    const panel = document.getElementById('view-' + viewId);
    if (panel) panel.classList.add('active');
    if (btn) btn.classList.add('active');
}

// ===== STARDATE =====
function getStardate() {
    const now = new Date();
    const y = now.getFullYear();
    const start = new Date(y, 0, 1);
    const dayOfYear = Math.floor((now - start) / 86400000);
    return ((y - 2000) * 1000 + dayOfYear * 2.7397).toFixed(1);
}

// ===== DATA LOADING =====
let allDevices = [];

async function loadStatus() {
    try {
        const resp = await fetch('/api/system-status');
        if (!resp.ok) return;
        const d = await resp.json();
        const sys = d.system || {};
        const devices = sys.devices || [];
        allDevices = devices;

        const aps = devices.filter(x => x.type === 'uap');
        const switches = devices.filter(x => x.type === 'usw');
        const apsOn = aps.filter(x => x.state === 1).length;
        const swOn = switches.filter(x => x.state === 1).length;
        const totalOn = devices.filter(x => x.state === 1).length;

        // Topbar
        document.getElementById('gw-model').textContent = sys.gateway_model || 'Cloud Hosted';
        document.getElementById('client-count').textContent = devices.reduce((s,d) => s + (d.num_sta||0), 0) || '--';
        document.getElementById('ap-count').textContent = aps.length;
        document.getElementById('wan-status').textContent = sys.wan_status || (sys.is_hosted ? 'Cloud' : 'Offline');
        document.getElementById('uptime-val').textContent = sys.uptime || '--';
        document.getElementById('conn-dot').className = d.connected ? 'readout-dot' : 'readout-dot offline';

        // Status panels
        document.getElementById('d-aps').textContent = apsOn + '/' + aps.length;
        document.getElementById('d-switches').textContent = swOn + '/' + switches.length;
        document.getElementById('d-clients').textContent = devices.reduce((s,d) => s + (d.num_sta||0), 0) || '--';
        document.getElementById('d-model').textContent = sys.gateway_model || 'Cloud Hosted';
        document.getElementById('d-fw').textContent = sys.gateway_version || '--';
        document.getElementById('d-wanip').textContent = sys.wan_ip || (sys.is_hosted ? 'Cloud Managed' : '--');
        document.getElementById('d-latency').textContent = sys.latency || '--';
        document.getElementById('d-down').textContent = sys.download_speed || '--';
        document.getElementById('d-up').textContent = sys.upload_speed || '--';

        // Health rows
        document.getElementById('health-rows').innerHTML = devices.map(dev => {
            const on = dev.state === 1;
            return '<div class="data-row"><span class="data-label">' + (dev.name||dev.model) + '</span><span class="data-val' + (on ? ' highlight' : ' warn') + '">' + (on ? 'ONLINE' : 'OFFLINE') + '</span></div>';
        }).join('');

        // Diagnostics
        document.getElementById('diag-total').textContent = devices.length;
        document.getElementById('diag-online').textContent = totalOn;
        document.getElementById('diag-offline').textContent = devices.length - totalOn;
        document.getElementById('diag-ctrl').textContent = sys.is_hosted ? 'Cloud Hosted' : (sys.gateway_model || '--');

        // Stardate
        document.getElementById('stardate').textContent = 'STARDATE ' + getStardate();

        // Update floor plan & device list
        renderFloorPlan(devices);
        renderDeviceList(devices);
    } catch(e) { console.error('Status load failed', e); }
}

// ===== FLOOR PLAN RENDERING =====
function renderFloorPlan(devices) {
    const g = document.getElementById('fp-devices');
    const cg = document.getElementById('fp-connections');
    g.innerHTML = '';
    cg.innerHTML = '';

    // Position devices in rooms
    const positions = [];
    const aps = devices.filter(d => d.type === 'uap');
    const sws = devices.filter(d => d.type === 'usw');

    // Place APs across rooms
    const apRooms = [
        {x:155,y:120}, {x:390,y:120}, {x:590,y:120}, {x:780,y:120},
        {x:205,y:300}, {x:505,y:300}, {x:750,y:300}
    ];
    aps.forEach((dev, i) => {
        const pos = apRooms[i % apRooms.length];
        positions.push({...dev, x:pos.x, y:pos.y});
        const on = dev.state === 1;
        const color = on ? 'var(--teal)' : 'var(--red)';
        g.innerHTML += '<g class="fp-device" onclick="showDevicePopup(event,' + JSON.stringify(dev).replace(/"/g,'&quot;') + ')">' +
            '<circle cx="' + pos.x + '" cy="' + pos.y + '" r="14" class="fp-device-ring ' + (on?'online':'offline') + '"/>' +
            '<text x="' + pos.x + '" y="' + (pos.y+3) + '" text-anchor="middle" fill="' + color + '" font-size="12">üì°</text>' +
            '<text class="fp-device-label" x="' + pos.x + '" y="' + (pos.y+24) + '">' + (dev.name||dev.model) + '</text>' +
            '<text class="fp-device-status ' + (on?'online':'offline') + '" x="' + pos.x + '" y="' + (pos.y+32) + '">' + (on?'ONLINE':'OFFLINE') + '</text>' +
            '</g>';
    });

    // Place switches in server room area
    const swRooms = [{x:540,y:90}, {x:590,y:90}, {x:640,y:90}];
    sws.forEach((dev, i) => {
        const pos = swRooms[i % swRooms.length];
        positions.push({...dev, x:pos.x, y:pos.y});
        const on = dev.state === 1;
        const color = on ? 'var(--blue)' : 'var(--red)';
        g.innerHTML += '<g class="fp-device" onclick="showDevicePopup(event,' + JSON.stringify(dev).replace(/"/g,'&quot;') + ')">' +
            '<rect x="' + (pos.x-12) + '" y="' + (pos.y-8) + '" width="24" height="16" rx="3" fill="none" stroke="' + color + '" stroke-width="1.5" class="fp-device-ring ' + (on?'online':'offline') + '"/>' +
            '<text x="' + pos.x + '" y="' + (pos.y+3) + '" text-anchor="middle" fill="' + color + '" font-size="8">SW</text>' +
            '<text class="fp-device-label" x="' + pos.x + '" y="' + (pos.y+22) + '">' + (dev.name||dev.model) + '</text>' +
            '</g>';

        // Draw connections from switches to APs
        aps.forEach((ap, j) => {
            const apPos = apRooms[j % apRooms.length];
            if (ap.state === 1) {
                cg.innerHTML += '<line class="fp-connection" x1="' + pos.x + '" y1="' + (pos.y+10) + '" x2="' + apPos.x + '" y2="' + (apPos.y-16) + '"/>';
            }
        });
    });
}

function showDevicePopup(event, dev) {
    const popup = document.getElementById('device-popup');
    document.getElementById('dp-name').textContent = dev.name || dev.model;
    document.getElementById('dp-model').textContent = dev.model || '--';
    document.getElementById('dp-mac').textContent = dev.mac || '--';
    document.getElementById('dp-status').textContent = dev.state === 1 ? 'ONLINE' : 'OFFLINE';
    document.getElementById('dp-uptime').textContent = dev.uptime ? Math.floor(dev.uptime/3600) + 'h ' + Math.floor((dev.uptime%3600)/60) + 'm' : '--';
    popup.style.left = Math.min(event.clientX, window.innerWidth - 220) + 'px';
    popup.style.top = (event.clientY - 100) + 'px';
    popup.classList.add('show');
    setTimeout(() => popup.classList.remove('show'), 4000);
}

// ===== DEVICE LIST RENDERING =====
function renderDeviceList(devices) {
    const c = document.getElementById('device-list-container');
    c.innerHTML = '<div class="panels-grid" style="grid-template-columns:1fr">' +
        devices.map((dev, i) => {
            const on = dev.state === 1;
            const typeIcon = dev.type === 'uap' ? 'üì°' : dev.type === 'usw' ? 'üîå' : 'üñ•Ô∏è';
            const upStr = dev.uptime ? Math.floor(dev.uptime/86400) + 'd ' + Math.floor((dev.uptime%86400)/3600) + 'h' : '--';
            return '<div class="data-panel" style="animation-delay:' + (i*0.05) + 's">' +
                '<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:.5rem">' +
                '<div class="panel-title" style="margin:0">' + typeIcon + ' ' + (dev.name||dev.model) + '</div>' +
                '<span class="data-val' + (on?' highlight':' warn') + '" style="font-size:.65rem">' + (on?'‚óè ONLINE':'‚óè OFFLINE') + '</span>' +
                '</div>' +
                '<div style="display:grid;grid-template-columns:repeat(4,1fr);gap:8px">' +
                '<div class="data-row" style="flex-direction:column;gap:2px"><span class="data-label">Model</span><span class="data-val" style="font-size:.7rem">' + (dev.model||'--') + '</span></div>' +
                '<div class="data-row" style="flex-direction:column;gap:2px"><span class="data-label">MAC</span><span class="data-val" style="font-size:.65rem">' + (dev.mac||'--') + '</span></div>' +
                '<div class="data-row" style="flex-direction:column;gap:2px"><span class="data-label">Uptime</span><span class="data-val" style="font-size:.7rem">' + upStr + '</span></div>' +
                '<div class="data-row" style="flex-direction:column;gap:2px"><span class="data-label">Type</span><span class="data-val" style="font-size:.7rem">' + (dev.type||'--').toUpperCase() + '</span></div>' +
                '</div></div>';
        }).join('') + '</div>';
}

// ===== CONFIG SAVE =====
async function saveConfig() {
    const url = document.getElementById('cfg-url').value;
    const apiKey = document.getElementById('cfg-apikey').value;
    const user = document.getElementById('cfg-user').value;
    const pass = document.getElementById('cfg-pass').value;
    try {
        const resp = await fetch('/api/config/unifi', {
            method: 'POST',
            headers: {'Content-Type':'application/json'},
            body: JSON.stringify({controller_url:url, api_key:apiKey, username:user, password:pass, site_id:'default', verify_ssl:false})
        });
        if (resp.ok) {
            document.getElementById('config-overlay').classList.remove('show');
            setTimeout(loadStatus, 2000);
        }
    } catch(e) { console.error('Config save failed', e); }
}

// ===== INIT =====
loadStatus();
setInterval(loadStatus, 30000);
setInterval(() => { document.getElementById('stardate').textContent = 'STARDATE ' + getStardate(); }, 60000);
</script>
</body>
</html>
